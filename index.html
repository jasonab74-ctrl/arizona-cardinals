<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Arizona Cardinals — News</title>
  <link rel="icon" href="static/favicon.ico">
  <link rel="apple-touch-icon" href="static/apple-touch-icon.png">
  <link rel="manifest" href="static/manifest.webmanifest">
  <link rel="stylesheet" href="static/style.css">
  <style>
    :root{
      --brand:#97233F; /* Cardinals red */
      --brand-dark:#6f1b2e;
      --ink:#e8e8ea;
      --card:#111416;
      --chip:#1b1f22;
      --accent:#ffb612; /* gold beak */
    }
  </style>
</head>
<body>
  <header class="hero">
    <img class="logo" src="static/logo.png" alt="Cardinals logo" />
    <div class="title">
      <h1>Arizona<br>Cardinals —<br>News</h1>
      <div class="sub">Live feed • auto-updates</div>
    </div>
  </header>

  <main class="wrap">
    <section class="toolbar">
      <div>
        <label>Source:</label>
        <select id="srcSel"><option>All sources</option></select>
      </div>
      <div id="updated">Updated: —</div>
    </section>

    <nav id="links" class="chips"></nav>

    <div id="notice" class="notice" hidden>New items available — tap to refresh</div>
    <section id="list" class="cards">
      <div class="empty">No articles yet — the collector will populate shortly.</div>
    </section>
  </main>

  <footer class="foot">
    Powered by GitHub Pages
  </footer>

  <script>
  const list = document.getElementById('list');
  const srcSel = document.getElementById('srcSel');
  const updated = document.getElementById('updated');
  const linksBox = document.getElementById('links');

  let DATA = null;

  function fmtTime(ts){
    if(!ts) return '';
    const d = new Date(ts*1000);
    return d.toLocaleString();
  }

  function render(){
    if(!DATA) return;
    // Updated stamp
    const stamp = new Date(DATA.updated_at);
    updated.textContent = 'Updated: ' + stamp.toLocaleString();

    // Quick links
    linksBox.innerHTML = '';
    (DATA.links || []).forEach(l=>{
      const a = document.createElement('a');
      a.className = 'pill';
      a.href = l.url; a.target = '_blank'; a.rel='noopener';
      a.textContent = l.label;
      linksBox.appendChild(a);
    });

    // Sources dropdown
    srcSel.innerHTML = '';
    const optAll = document.createElement('option');
    optAll.value = ''; optAll.textContent = 'All sources';
    srcSel.appendChild(optAll);
    (DATA.sources || []).forEach(s=>{
      const o = document.createElement('option');
      o.value = s; o.textContent = s; srcSel.appendChild(o);
    });

    // Articles
    drawCards();
  }

  function drawCards(){
    const src = srcSel.value;
    const items = (DATA.items || []).filter(x=>!src || x.source===src);
    list.innerHTML = '';
    if(items.length===0){
      const d = document.createElement('div');
      d.className='empty';
      d.textContent='No articles match this filter.';
      list.appendChild(d);
      return;
    }
    items.forEach(it=>{
      const a = document.createElement('a');
      a.className='card'; a.href = it.link; a.target='_blank' ; a.rel='noopener';
      a.innerHTML = `
        <div class="title">${it.title}</div>
        <div class="meta">${it.source}${it.published ? ' • ' + fmtTime(it.published) : ''}</div>
      `;
      list.appendChild(a);
    });
  }

  srcSel.addEventListener('change', drawCards);

  async function load(){
    const v = Date.now(); // bust cache
    const res = await fetch('items.json?v='+v, {cache:'no-store'});
    if(!res.ok){ return; }
    DATA = await res.json();
    render();
  }

  load();
  // client-side ping (5 min) to catch updates
  setInterval(load, 5*60*1000);
  </script>
</body>
</html>