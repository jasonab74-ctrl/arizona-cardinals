<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Arizona Cardinals — News</title>
  <link rel="stylesheet" href="static/style.css" />
  <link rel="icon" href="static/favicon.ico">
  <link rel="apple-touch-icon" href="static/apple-touch-icon.png">
  <meta name="theme-color" content="#97233F">
</head>
<body>
  <header class="hero">
    <div class="hero-left">
      <img src="static/logo.png" alt="Arizona Cardinals" class="logo" />
      <div>
        <h1>Arizona Cardinals —<br/> News</h1>
        <p class="sub">Live feed • auto-updates</p>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="controls">
      <div>
        <label>Source:</label>
        <select id="sourceFilter"></select>
      </div>
      <div>
        <label>Updated:</label>
        <span id="updated">—</span>
      </div>
    </div>

    <div id="buttons" class="buttons"></div>
    <div id="empty" class="empty" hidden>No articles yet — the collector will populate shortly.</div>
    <div id="feed" class="grid"></div>
  </main>

  <footer class="foot">Powered by GitHub Pages</footer>

  <script>
  const FEED_URL = "items.json";
  let cache = { items: [], sources: [], updated_at: null, links: [] };

  function el(tag, cls){ const e=document.createElement(tag); if(cls)e.className=cls; return e; }
  function fmtDate(iso){
    if(!iso) return "—";
    const d = new Date(iso);
    return d.toLocaleString();
  }

  function renderButtons(links){
    const box = document.getElementById("buttons"); box.innerHTML="";
    links.forEach(l=>{
      const a = el("a","pill"); a.href=l.url; a.target="_blank"; a.rel="noopener";
      a.textContent=l.label; box.appendChild(a);
    });
  }

  function renderSources(sources){
    const sel = document.getElementById("sourceFilter");
    sel.innerHTML = "";
    const optAll = el("option"); optAll.value = ""; optAll.textContent = "All sources"; sel.appendChild(optAll);
    sources.forEach(s=>{
      const o = el("option"); o.value=s; o.textContent=s; sel.appendChild(o);
    });
    sel.onchange = ()=> renderFeed();
  }

  function renderFeed(){
    const grid = document.getElementById("feed");
    const empty = document.getElementById("empty");
    grid.innerHTML = "";
    let items = cache.items.slice();

    const sel = document.getElementById("sourceFilter");
    if(sel.value) items = items.filter(x => x.source === sel.value);

    document.getElementById("updated").textContent = fmtDate(cache.updated_at);

    if(!items.length){
      empty.hidden = false; return;
    }
    empty.hidden = true;

    items.forEach(x=>{
      const card = el("a","card"); card.href = x.url; card.target="_blank"; card.rel="noopener";
      const h = el("div","title"); h.textContent = x.title; card.appendChild(h);
      const m = el("div","meta");
      m.textContent = `${x.source} • ${fmtDate(x.published_at)}`;
      card.appendChild(m);
      grid.appendChild(card);
    });
  }

  async function load(){
    try {
      const r = await fetch(FEED_URL, { cache: "no-store" });
      const data = await r.json();
      cache = data;
      renderButtons(data.links || []);
      renderSources(data.sources || []);
      renderFeed();
    } catch (e){
      console.warn("items.json not ready yet", e);
      document.getElementById("empty").hidden = false;
    }
  }

  load();
  // client auto-refresh
  setInterval(load, 5 * 60 * 1000);
  </script>
</body>
</html>